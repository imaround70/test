<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1500 Calorie Meal Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Custom scrollbar styles */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Dark mode scrollbar */
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* Modal overlay */
        .modal-overlay {
            backdrop-filter: blur(4px);
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                -webkit-tap-highlight-color: transparent;
            }
            button {
                min-height: 44px;
                min-width: 44px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide Icons as React components
        const Clock = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Download = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m4-5l5 5 5-5m-5 5V3" />
            </svg>
        );

        const ShoppingCart = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Home = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const List = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        );

        const Sun = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        );

        const Moon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const MealPlanner = () => {
            const [currentTheme, setCurrentTheme] = useState(() => {
                return parseInt(localStorage.getItem('app-theme') || '0');
            });
            const [darkMode, setDarkMode] = useState(() => {
                return localStorage.getItem('app-dark-mode') === 'true';
            });
            const [currentTime, setCurrentTime] = useState(new Date());
            const [currentDay, setCurrentDay] = useState(1);
            const [weekMeals, setWeekMeals] = useState({});
            const [progress, setProgress] = useState({});
            const [nextMealTimers, setNextMealTimers] = useState({});
            const [showRecipe, setShowRecipe] = useState(null);
            const [overeatingModal, setOvereatingModal] = useState(null);
            const [extraCalories, setExtraCalories] = useState('');
            const [shoppingList, setShoppingList] = useState([]);
            const [showShoppingList, setShowShoppingList] = useState(false);
            const [currentPage, setCurrentPage] = useState('meals');

            // Update body class for dark mode
            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem('app-dark-mode', darkMode);
            }, [darkMode]);

            // Save theme to localStorage
            useEffect(() => {
                localStorage.setItem('app-theme', currentTheme.toString());
            }, [currentTheme]);

            const themes = [
                { name: 'Lavender Dream', bg: 'from-purple-50 to-pink-50', card: 'bg-white/80', accent: 'bg-purple-400', accentHover: 'hover:bg-purple-500', text: 'text-purple-900', border: 'border-purple-300' },
                { name: 'Mint Breeze', bg: 'from-green-50 to-blue-50', card: 'bg-white/80', accent: 'bg-green-400', accentHover: 'hover:bg-green-500', text: 'text-green-900', border: 'border-green-300' },
                { name: 'Peach Sunset', bg: 'from-orange-50 to-yellow-50', card: 'bg-white/80', accent: 'bg-orange-400', accentHover: 'hover:bg-orange-500', text: 'text-orange-900', border: 'border-orange-300' }
            ];

            const daysOfWeek = [
                { name: 'Monday', color: 'bg-purple-100 hover:bg-purple-200 border-purple-300', activeColor: 'bg-purple-300 border-purple-500' },
                { name: 'Tuesday', color: 'bg-blue-100 hover:bg-blue-200 border-blue-300', activeColor: 'bg-blue-300 border-blue-500' },
                { name: 'Wednesday', color: 'bg-green-100 hover:bg-green-200 border-green-300', activeColor: 'bg-green-300 border-green-500' },
                { name: 'Thursday', color: 'bg-yellow-100 hover:bg-yellow-200 border-yellow-300', activeColor: 'bg-yellow-300 border-yellow-500' },
                { name: 'Friday', color: 'bg-orange-100 hover:bg-orange-200 border-orange-300', activeColor: 'bg-orange-300 border-orange-500' },
                { name: 'Saturday', color: 'bg-pink-100 hover:bg-pink-200 border-pink-300', activeColor: 'bg-pink-300 border-pink-500' },
                { name: 'Sunday', color: 'bg-red-100 hover:bg-red-200 border-red-300', activeColor: 'bg-red-300 border-red-500' }
            ];

            // MEAL DATABASE - General pool for random selection
            // Each meal category has exact calories for 1500 cal daily target
            const mealDatabase = {
                breakfast: [
                    { name: 'ðŸ¥£ Berry Oatmeal Bowl', calories: 350, protein: 12, carbs: 58, fat: 8, time: 10, ingredients: ['3/4 cup oats', '1 cup milk', '3/4 cup berries', '1 tbsp honey', '8 almonds'], steps: ['Heat milk in pot', 'Add oats and cook 5-7 min', 'Top with berries, honey and almonds'], substitutes: ['Use almond milk', 'Add banana', 'Try chia seeds'] },
                    { name: 'ðŸ³ Veggie Scramble Deluxe', calories: 350, protein: 24, carbs: 16, fat: 20, time: 12, ingredients: ['3 eggs', '1/2 cup peppers', '1/3 cup mushrooms', '1/4 cup onion', '2 oz cheese', '1 slice toast'], steps: ['Whisk eggs with seasoning', 'SautÃ© vegetables until soft', 'Add eggs and cheese, scramble', 'Serve with toast'], substitutes: ['Use egg whites', 'Add spinach', 'Try feta cheese'] },
                    { name: 'ðŸ¥ž Protein Pancake Stack', calories: 350, protein: 26, carbs: 40, fat: 9, time: 20, ingredients: ['1.5 scoops protein powder', '1 banana', '2 eggs', '1/3 cup oats', '1/2 cup berries', '1 tbsp syrup'], steps: ['Blend protein, banana, eggs, oats', 'Cook pancakes on griddle', 'Flip when bubbly', 'Top with berries and syrup'], substitutes: ['Use Greek yogurt', 'Add blueberries', 'Try honey instead'] },
                    { name: 'ðŸž Avocado Egg Toast', calories: 350, protein: 16, carbs: 30, fat: 18, time: 12, ingredients: ['2 slices whole grain bread', '2/3 avocado', '2 eggs', '1 tomato', 'seasoning'], steps: ['Toast bread until golden', 'Mash avocado with seasoning', 'Fry or poach eggs', 'Top with tomato slices'], substitutes: ['Add smoked salmon', 'Use sweet potato', 'Try feta cheese'] },
                    { name: 'ðŸ¥— Greek Yogurt Parfait', calories: 350, protein: 22, carbs: 50, fat: 7, time: 5, ingredients: ['1.5 cups Greek yogurt', '2/3 cup granola', '3/4 cup mixed berries', '1 tbsp honey'], steps: ['Layer yogurt in bowl', 'Add granola and berries', 'Drizzle with honey'], substitutes: ['Use coconut yogurt', 'Add banana', 'Try chia pudding'] },
                    { name: 'ðŸ¥¤ Berry Protein Smoothie Bowl', calories: 350, protein: 18, carbs: 52, fat: 8, time: 10, ingredients: ['1 banana', '1 cup spinach', '3/4 cup mango', '1 scoop protein', '1 cup milk', '1/3 cup granola'], steps: ['Blend fruit, spinach, protein, milk', 'Pour into bowl', 'Top with granola and berries'], substitutes: ['Use kale', 'Add peanut butter', 'Try coconut milk'] },
                    { name: 'ðŸ§‡ Blueberry Waffles', calories: 350, protein: 12, carbs: 54, fat: 10, time: 15, ingredients: ['1.5 cups waffle mix', '1 egg', '1 cup milk', '2 tbsp honey', '3/4 cup blueberries'], steps: ['Mix waffle batter', 'Cook in waffle maker', 'Top with blueberries and honey'], substitutes: ['Use almond flour', 'Add Greek yogurt', 'Try strawberries'] },
                    { name: 'ðŸ¥– Breakfast Burrito', calories: 350, protein: 20, carbs: 36, fat: 14, time: 15, ingredients: ['1 large tortilla', '2 eggs', '1/4 cup black beans', '2 oz cheese', 'salsa', 'avocado'], steps: ['Scramble eggs', 'Warm beans', 'Fill tortilla with eggs, beans, cheese', 'Top with salsa and avocado'], substitutes: ['Add sausage', 'Use turkey bacon', 'Try Greek yogurt'] },
                    { name: 'ðŸ¥ Croissant Sandwich', calories: 350, protein: 18, carbs: 32, fat: 16, time: 10, ingredients: ['1 croissant', '2 eggs', '2 slices turkey', '1 slice cheese', 'spinach'], steps: ['Slice croissant', 'Cook eggs', 'Layer turkey, eggs, cheese, spinach', 'Toast lightly'], substitutes: ['Use ham', 'Add tomato', 'Try avocado'] },
                    { name: 'ðŸŒ Banana Nut Oatmeal', calories: 350, protein: 11, carbs: 56, fat: 10, time: 10, ingredients: ['3/4 cup oats', '1 cup milk', '1 banana', '2 tbsp walnuts', '1 tbsp honey', 'cinnamon'], steps: ['Cook oats with milk', 'Slice banana on top', 'Add walnuts and honey', 'Sprinkle cinnamon'], substitutes: ['Use pecans', 'Add protein powder', 'Try almond butter'] },
                    { name: 'ðŸ³ Shakshuka', calories: 350, protein: 16, carbs: 28, fat: 18, time: 25, ingredients: ['2 eggs', '1 cup tomato sauce', '1/2 cup peppers', 'onion', 'feta', 'pita bread'], steps: ['SautÃ© onions and peppers', 'Add tomato sauce and simmer', 'Crack eggs into sauce', 'Serve with pita and feta'], substitutes: ['Add spinach', 'Use whole grain bread', 'Try goat cheese'] },
                    { name: 'ðŸ¥“ Classic American Breakfast', calories: 350, protein: 22, carbs: 24, fat: 18, time: 15, ingredients: ['2 eggs', '2 strips turkey bacon', '1 slice toast', '1/2 cup hash browns'], steps: ['Fry eggs to preference', 'Cook bacon until crispy', 'Toast bread', 'Pan-fry hash browns'], substitutes: ['Use regular bacon', 'Add cheese', 'Try avocado'] },
                    { name: 'ðŸ¥¯ Bagel with Lox', calories: 350, protein: 20, carbs: 44, fat: 10, time: 5, ingredients: ['1 whole grain bagel', '2 oz smoked salmon', '2 tbsp cream cheese', 'capers', 'red onion'], steps: ['Toast bagel', 'Spread cream cheese', 'Layer salmon', 'Top with capers and onion'], substitutes: ['Use avocado', 'Add cucumber', 'Try dill'] },
                    { name: 'ðŸŽ Apple Cinnamon Quinoa', calories: 350, protein: 10, carbs: 60, fat: 8, time: 20, ingredients: ['3/4 cup quinoa', '1 apple', '1 cup milk', 'cinnamon', '1 tbsp honey', 'walnuts'], steps: ['Cook quinoa in milk', 'Dice and add apple', 'Season with cinnamon', 'Top with honey and walnuts'], substitutes: ['Use oats', 'Add raisins', 'Try maple syrup'] },
                    { name: 'ðŸ§€ Cheese Omelet', calories: 350, protein: 24, carbs: 18, fat: 20, time: 10, ingredients: ['3 eggs', '2 oz cheddar', '1/4 cup mushrooms', 'herbs', '1 slice toast'], steps: ['Whisk eggs', 'Cook omelet with cheese and mushrooms', 'Fold and serve', 'Toast on the side'], substitutes: ['Use Swiss', 'Add ham', 'Try peppers'] },
                    { name: 'ðŸ¥¤ Peanut Butter Smoothie', calories: 350, protein: 16, carbs: 48, fat: 12, time: 5, ingredients: ['1 banana', '2 tbsp peanut butter', '1 cup milk', '1/2 scoop protein', 'ice'], steps: ['Blend all ingredients', 'Add ice for thickness', 'Pour and enjoy'], substitutes: ['Use almond butter', 'Add cocoa', 'Try oat milk'] },
                    { name: 'ðŸž French Toast', calories: 350, protein: 14, carbs: 48, fat: 12, time: 15, ingredients: ['2 slices bread', '2 eggs', '1/4 cup milk', 'cinnamon', '2 tbsp syrup', 'berries'], steps: ['Whisk eggs with milk and cinnamon', 'Dip bread and cook', 'Top with syrup and berries'], substitutes: ['Use brioche', 'Add banana', 'Try honey'] },
                    { name: 'ðŸ¥š Egg & Cheese Muffin', calories: 350, protein: 22, carbs: 32, fat: 14, time: 10, ingredients: ['1 English muffin', '2 eggs', '2 oz cheese', '1 slice ham'], steps: ['Toast muffin', 'Cook eggs', 'Melt cheese on eggs', 'Add ham and assemble'], substitutes: ['Use turkey', 'Add tomato', 'Try avocado'] },
                    { name: 'ðŸ¥£ Chia Pudding', calories: 350, protein: 12, carbs: 46, fat: 14, time: 5, ingredients: ['1/3 cup chia seeds', '1.5 cups almond milk', '1 tbsp honey', '1/2 cup berries', 'granola'], steps: ['Mix chia with milk overnight', 'Top with honey', 'Add berries and granola'], substitutes: ['Use coconut milk', 'Add mango', 'Try nuts'] },
                    { name: 'ðŸŒ¯ Breakfast Wrap', calories: 350, protein: 20, carbs: 38, fat: 12, time: 12, ingredients: ['1 tortilla', '2 eggs', '1/4 cup beans', 'salsa', 'cheese', 'spinach'], steps: ['Scramble eggs', 'Warm tortilla', 'Fill with eggs, beans, cheese', 'Add salsa and spinach'], substitutes: ['Add avocado', 'Use turkey sausage', 'Try hot sauce'] }
                ],
                lunch: [
                    { name: 'ðŸ¥™ Chicken Caesar Wrap', calories: 450, protein: 36, carbs: 40, fat: 14, time: 15, ingredients: ['6 oz chicken breast', '1 large tortilla', '2 cups romaine', '3 tbsp caesar dressing', '1 oz parmesan'], steps: ['Grill seasoned chicken', 'Toss lettuce with dressing and cheese', 'Wrap everything and slice'], substitutes: ['Use turkey breast', 'Add cherry tomatoes', 'Try Greek yogurt dressing'] },
                    { name: 'ðŸœ Asian Shrimp Noodle Bowl', calories: 450, protein: 30, carbs: 52, fat: 11, time: 20, ingredients: ['5 oz rice noodles', '6 oz shrimp', '2 cups mixed vegetables', '2 tbsp soy sauce', '1 tbsp sesame oil'], steps: ['Cook noodles per package', 'Stir-fry shrimp in sesame oil', 'Add vegetables and sauce', 'Toss with noodles'], substitutes: ['Use chicken', 'Add edamame', 'Try tofu'] },
                    { name: 'ðŸ¥— Mediterranean Chicken Salad', calories: 450, protein: 34, carbs: 36, fat: 17, time: 15, ingredients: ['5 oz grilled chicken', '2 cups mixed greens', '2/3 cup chickpeas', '1/3 cup feta', 'olives', '2 tbsp olive oil'], steps: ['Grill and slice chicken', 'Combine greens and chickpeas', 'Add feta and olives', 'Drizzle with olive oil'], substitutes: ['Add cucumber', 'Use balsamic', 'Try goat cheese'] },
                    { name: 'ðŸŒ¯ Turkey Club Wrap', calories: 450, protein: 32, carbs: 42, fat: 14, time: 10, ingredients: ['1 large wrap', '5 oz turkey breast', '3 tbsp hummus', '2 slices bacon', 'lettuce', 'tomato'], steps: ['Spread hummus on wrap', 'Layer turkey and bacon', 'Add vegetables', 'Roll tightly and slice'], substitutes: ['Use chicken', 'Add peppers', 'Try avocado'] },
                    { name: 'ðŸ Caprese Chicken Pasta', calories: 450, protein: 30, carbs: 54, fat: 12, time: 20, ingredients: ['1.5 cups pasta', '4 oz chicken', '1 cup cherry tomatoes', '4 oz mozzarella', 'basil', 'balsamic'], steps: ['Cook pasta', 'Grill chicken', 'Halve tomatoes', 'Toss with mozzarella and basil'], substitutes: ['Add pesto', 'Use shrimp', 'Try spinach'] },
                    { name: 'ðŸ¥ª Tuna Melt Sandwich', calories: 450, protein: 34, carbs: 40, fat: 13, time: 12, ingredients: ['2 slices bread', '1 can tuna', '2 tbsp mayo', 'celery', 'lettuce', '2 oz cheese'], steps: ['Mix tuna with mayo and celery', 'Spread on bread', 'Add lettuce and cheese', 'Grill until cheese melts'], substitutes: ['Use avocado mayo', 'Add pickles', 'Try whole grain bread'] },
                    { name: 'ðŸ› Quinoa Power Bowl', calories: 450, protein: 18, carbs: 60, fat: 14, time: 25, ingredients: ['3/4 cup quinoa', '2/3 cup chickpeas', '1.5 cups roasted vegetables', '3 tbsp tahini', 'lemon'], steps: ['Cook quinoa', 'Roast vegetables', 'Arrange in bowl', 'Drizzle with tahini'], substitutes: ['Use brown rice', 'Add tofu', 'Try hummus'] },
                    { name: 'ðŸŒ® Chicken Taco Bowl', calories: 450, protein: 32, carbs: 46, fat: 14, time: 20, ingredients: ['5 oz chicken', '3/4 cup black beans', '3/4 cup rice', 'salsa', 'cheese', 'avocado'], steps: ['Season and grill chicken', 'Cook rice', 'Warm beans', 'Assemble bowl with toppings'], substitutes: ['Use beef', 'Add corn', 'Try Greek yogurt'] },
                    { name: 'ðŸ¥— Cobb Salad', calories: 450, protein: 34, carbs: 18, fat: 28, time: 15, ingredients: ['4 oz chicken', '2 cups lettuce', '2 eggs', '2 strips bacon', 'avocado', 'tomato', 'blue cheese'], steps: ['Grill chicken', 'Boil eggs', 'Cook bacon', 'Arrange all on lettuce', 'Add dressing'], substitutes: ['Use turkey', 'Add cucumber', 'Try ranch'] },
                    { name: 'ðŸ• BBQ Chicken Flatbread', calories: 450, protein: 30, carbs: 50, fat: 14, time: 20, ingredients: ['1 flatbread', '5 oz chicken', '1/3 cup BBQ sauce', '3 oz mozzarella', 'red onion', 'cilantro'], steps: ['Spread BBQ sauce on flatbread', 'Top with chicken and cheese', 'Add onions', 'Bake at 425Â°F for 12 min'], substitutes: ['Use naan', 'Add peppers', 'Try pineapple'] },
                    { name: 'ðŸ¥™ Falafel Wrap', calories: 450, protein: 16, carbs: 58, fat: 16, time: 15, ingredients: ['1 pita', '4 falafel', '1/4 cup hummus', 'cucumber', 'tomato', 'tahini'], steps: ['Warm pita', 'Spread hummus', 'Add falafel and vegetables', 'Drizzle tahini'], substitutes: ['Add feta', 'Use Greek yogurt', 'Try hot sauce'] },
                    { name: 'ðŸœ Pho Bowl', calories: 450, protein: 28, carbs: 58, fat: 8, time: 30, ingredients: ['4 oz rice noodles', '5 oz beef', 'broth', 'bean sprouts', 'herbs', 'lime'], steps: ['Prepare broth', 'Cook noodles', 'Thinly slice beef', 'Assemble bowl with toppings'], substitutes: ['Use chicken', 'Add mushrooms', 'Try tofu'] },
                    { name: 'ðŸ¥— Southwest Salad', calories: 450, protein: 30, carbs: 42, fat: 16, time: 15, ingredients: ['4 oz chicken', '2 cups lettuce', '1/2 cup corn', '1/2 cup black beans', 'avocado', 'tortilla strips'], steps: ['Grill chicken', 'Mix lettuce with corn and beans', 'Top with chicken and avocado', 'Add tortilla strips'], substitutes: ['Use steak', 'Add salsa', 'Try chipotle dressing'] },
                    { name: 'ðŸ Pesto Pasta Primavera', calories: 450, protein: 16, carbs: 62, fat: 16, time: 20, ingredients: ['1.5 cups pasta', '2 cups vegetables', '1/4 cup pesto', 'parmesan', 'pine nuts'], steps: ['Cook pasta', 'SautÃ© vegetables', 'Toss with pesto', 'Top with parmesan and pine nuts'], substitutes: ['Add chicken', 'Use zucchini noodles', 'Try sun-dried tomatoes'] },
                    { name: 'ðŸ¥ª Club Sandwich', calories: 450, protein: 32, carbs: 44, fat: 14, time: 10, ingredients: ['3 slices bread', '4 oz turkey', '2 slices bacon', 'lettuce', 'tomato', 'mayo'], steps: ['Toast bread', 'Layer turkey and bacon', 'Add lettuce and tomato', 'Stack and cut'], substitutes: ['Use chicken', 'Add avocado', 'Try mustard'] },
                    { name: 'ðŸ› Teriyaki Chicken Bowl', calories: 450, protein: 32, carbs: 56, fat: 8, time: 25, ingredients: ['5 oz chicken', '1 cup rice', '1.5 cups broccoli', '3 tbsp teriyaki sauce', 'sesame seeds'], steps: ['Cook rice', 'Grill chicken with teriyaki', 'Steam broccoli', 'Assemble bowl'], substitutes: ['Use salmon', 'Add carrots', 'Try brown rice'] },
                    { name: 'ðŸ¥™ Greek Gyro', calories: 450, protein: 28, carbs: 48, fat: 14, time: 15, ingredients: ['1 pita', '5 oz lamb or beef', 'tzatziki', 'lettuce', 'tomato', 'onion'], steps: ['Cook meat with seasoning', 'Warm pita', 'Add meat and vegetables', 'Top with tzatziki'], substitutes: ['Use chicken', 'Add feta', 'Try cucumber'] },
                    { name: 'ðŸœ Pad Thai', calories: 450, protein: 24, carbs: 58, fat: 12, time: 20, ingredients: ['4 oz rice noodles', '4 oz shrimp', 'egg', 'bean sprouts', 'peanuts', 'pad thai sauce'], steps: ['Cook noodles', 'Stir-fry shrimp and egg', 'Add noodles and sauce', 'Top with peanuts and sprouts'], substitutes: ['Use chicken', 'Add tofu', 'Try lime'] },
                    { name: 'ðŸ¥— Asian Chicken Salad', calories: 450, protein: 32, carbs: 38, fat: 16, time: 15, ingredients: ['5 oz chicken', '2 cups cabbage', '1 cup edamame', 'mandarin oranges', 'almonds', 'sesame dressing'], steps: ['Grill chicken', 'Mix cabbage and edamame', 'Add oranges and almonds', 'Toss with dressing'], substitutes: ['Add noodles', 'Use peanuts', 'Try ginger dressing'] },
                    { name: 'ðŸŒ¯ Burrito Bowl', calories: 450, protein: 30, carbs: 52, fat: 12, time: 20, ingredients: ['5 oz chicken', '3/4 cup rice', '1/2 cup beans', 'salsa', 'cheese', 'lettuce'], steps: ['Cook rice', 'Grill chicken', 'Warm beans', 'Layer in bowl with toppings'], substitutes: ['Use steak', 'Add guacamole', 'Try pico de gallo'] }
                ],
                dinner: [
                    { name: 'ðŸ— Herb Roasted Chicken', calories: 500, protein: 40, carbs: 34, fat: 18, time: 45, ingredients: ['7 oz chicken breast', '1 cup roasted vegetables', '2/3 cup quinoa', 'herbs', 'olive oil'], steps: ['Season chicken with herbs', 'Roast at 400Â°F for 35 min', 'Cook quinoa', 'Roast vegetables with olive oil'], substitutes: ['Use salmon', 'Add sweet potato', 'Try brown rice'] },
                    { name: 'ðŸŸ Baked Salmon & Rice', calories: 500, protein: 36, carbs: 40, fat: 18, time: 30, ingredients: ['6 oz salmon fillet', '1.5 cups asparagus', '3/4 cup brown rice', 'lemon', 'dill'], steps: ['Season salmon with lemon and dill', 'Bake at 375Â°F for 22 min', 'Cook rice', 'Roast asparagus'], substitutes: ['Use trout', 'Add broccoli', 'Try quinoa'] },
                    { name: 'ðŸ Turkey Bolognese Pasta', calories: 500, protein: 34, carbs: 56, fat: 12, time: 40, ingredients: ['6 oz ground turkey', '1.5 cups pasta', '1 cup marinara', '1 cup zucchini', 'parmesan'], steps: ['Brown turkey with seasoning', 'Add marinara and simmer', 'Cook pasta al dente', 'Toss everything together'], substitutes: ['Use beef', 'Add mushrooms', 'Try whole wheat pasta'] },
                    { name: 'ðŸ¥© Beef Stir-Fry Bowl', calories: 500, protein: 32, carbs: 46, fat: 16, time: 25, ingredients: ['5 oz beef sirloin', '2 cups mixed vegetables', '3/4 cup jasmine rice', '2 tbsp stir-fry sauce', 'sesame seeds'], steps: ['Cook rice', 'Stir-fry beef on high heat', 'Add vegetables and sauce', 'Serve over rice with sesame'], substitutes: ['Use chicken', 'Add cashews', 'Try brown rice'] },
                    { name: 'ðŸ² Hearty Vegetarian Chili', calories: 500, protein: 20, carbs: 70, fat: 14, time: 35, ingredients: ['1.5 cups beans', '1 cup tomatoes', '1 cup peppers', 'onion', 'spices', 'avocado', 'cornbread'], steps: ['SautÃ© onions and peppers', 'Add beans, tomatoes, spices', 'Simmer 25 minutes', 'Top with avocado'], substitutes: ['Add ground beef', 'Top with yogurt', 'Serve with rice'] },
                    { name: 'ðŸ• Homemade BBQ Chicken Pizza', calories: 500, protein: 30, carbs: 54, fat: 16, time: 30, ingredients: ['1 naan bread', '5 oz chicken', '1/2 cup BBQ sauce', '4 oz mozzarella', 'red onion', 'cilantro'], steps: ['Spread BBQ sauce on naan', 'Top with chicken and cheese', 'Add onions', 'Bake at 425Â°F for 15 min'], substitutes: ['Use cauliflower crust', 'Add peppers', 'Try pineapple'] },
                    { name: 'ðŸ¥˜ Lemon Herb Cod Dinner', calories: 500, protein: 38, carbs: 40, fat: 14, time: 30, ingredients: ['7 oz cod fillet', '1.5 cups brussels sprouts', '2/3 cup couscous', 'lemon', 'thyme', 'olive oil'], steps: ['Season cod with lemon and thyme', 'Bake at 400Â°F for 18 min', 'Cook couscous', 'Roast brussels sprouts'], substitutes: ['Use halibut', 'Try cauliflower rice', 'Add green beans'] },
                    { name: 'ðŸ› Chicken Curry', calories: 500, protein: 34, carbs: 52, fat: 14, time: 35, ingredients: ['6 oz chicken', '1 cup curry sauce', '3/4 cup rice', '1 cup vegetables', 'naan'], steps: ['Cook chicken in curry sauce', 'Prepare rice', 'Add vegetables', 'Serve with naan'], substitutes: ['Use shrimp', 'Add coconut milk', 'Try cauliflower rice'] },
                    { name: 'ðŸ¥© Grilled Steak & Potatoes', calories: 500, protein: 36, carbs: 38, fat: 18, time: 30, ingredients: ['6 oz sirloin steak', '1 cup roasted potatoes', '1.5 cups green beans', 'garlic butter'], steps: ['Season and grill steak', 'Roast potatoes until crispy', 'SautÃ© green beans', 'Top steak with garlic butter'], substitutes: ['Use ribeye', 'Add mushrooms', 'Try asparagus'] },
                    { name: 'ðŸ Shrimp Scampi Pasta', calories: 500, protein: 32, carbs: 54, fat: 14, time: 25, ingredients: ['6 oz shrimp', '1.5 cups pasta', 'garlic', 'white wine', 'butter', 'parsley', 'lemon'], steps: ['Cook pasta', 'SautÃ© garlic in butter', 'Add shrimp and wine', 'Toss with pasta and lemon'], substitutes: ['Use chicken', 'Add tomatoes', 'Try zucchini noodles'] },
                    { name: 'ðŸŒ® Fish Tacos', calories: 500, protein: 32, carbs: 52, fat: 14, time: 20, ingredients: ['6 oz white fish', '3 tortillas', 'cabbage slaw', 'avocado', 'lime', 'cilantro'], steps: ['Season and grill fish', 'Warm tortillas', 'Assemble with slaw and avocado', 'Squeeze lime'], substitutes: ['Use shrimp', 'Add mango salsa', 'Try corn tortillas'] },
                    { name: 'ðŸ— Chicken Fajitas', calories: 500, protein: 34, carbs: 48, fat: 14, time: 25, ingredients: ['6 oz chicken', '1 cup peppers', '1 cup onions', '3 tortillas', 'salsa', 'cheese'], steps: ['Slice and season chicken', 'SautÃ© peppers and onions', 'Cook chicken', 'Serve with tortillas'], substitutes: ['Use steak', 'Add guacamole', 'Try whole wheat tortillas'] },
                    { name: 'ðŸ¥˜ Moroccan Chicken Tagine', calories: 500, protein: 32, carbs: 54, fat: 12, time: 45, ingredients: ['6 oz chicken', '1 cup chickpeas', '3/4 cup couscous', 'dried fruit', 'spices'], steps: ['Brown chicken with spices', 'Add chickpeas and simmer', 'Cook couscous', 'Garnish with dried fruit'], substitutes: ['Use lamb', 'Add vegetables', 'Try quinoa'] },
                    { name: 'ðŸ Lasagna', calories: 500, protein: 30, carbs: 48, fat: 18, time: 60, ingredients: ['lasagna noodles', '5 oz ground beef', 'ricotta', 'mozzarella', 'marinara', 'spinach'], steps: ['Brown beef', 'Layer noodles with cheese and sauce', 'Bake at 375Â°F for 40 min', 'Let rest before serving'], substitutes: ['Use turkey', 'Add mushrooms', 'Try zucchini noodles'] },
                    { name: 'ðŸŸ Teriyaki Glazed Salmon', calories: 500, protein: 36, carbs: 48, fat: 14, time: 25, ingredients: ['6 oz salmon', '3/4 cup rice', '1.5 cups broccoli', '3 tbsp teriyaki sauce', 'sesame seeds'], steps: ['Glaze salmon with teriyaki', 'Bake at 400Â°F for 15 min', 'Cook rice', 'Steam broccoli'], substitutes: ['Use chicken', 'Add edamame', 'Try brown rice'] },
                    { name: 'ðŸ¥˜ Jambalaya', calories: 500, protein: 28, carbs: 58, fat: 12, time: 40, ingredients: ['4 oz chicken', '3 oz sausage', '3/4 cup rice', 'peppers', 'tomatoes', 'cajun spices'], steps: ['Brown chicken and sausage', 'Add rice, vegetables, spices', 'Simmer until rice is cooked'], substitutes: ['Add shrimp', 'Use turkey sausage', 'Try cauliflower rice'] },
                    { name: 'ðŸ— Honey Mustard Chicken', calories: 500, protein: 38, carbs: 42, fat: 14, time: 35, ingredients: ['7 oz chicken', '1/4 cup honey mustard', '1 cup roasted vegetables', '2/3 cup sweet potato'], steps: ['Coat chicken in honey mustard', 'Bake at 375Â°F for 30 min', 'Roast vegetables and sweet potato'], substitutes: ['Use salmon', 'Add Brussels sprouts', 'Try regular potatoes'] },
                    { name: 'ðŸœ Ramen Bowl', calories: 500, protein: 26, carbs: 62, fat: 12, time: 25, ingredients: ['4 oz ramen noodles', '1 egg', '4 oz pork', 'broth', 'green onions', 'nori'], steps: ['Prepare broth', 'Cook noodles', 'Soft boil egg', 'Add toppings'], substitutes: ['Use chicken', 'Add mushrooms', 'Try tofu'] },
                    { name: 'ðŸ¥© Meatloaf & Mashed Potatoes', calories: 500, protein: 32, carbs: 44, fat: 18, time: 50, ingredients: ['6 oz ground beef', 'breadcrumbs', 'egg', '1 cup mashed potatoes', '1 cup green beans'], steps: ['Mix beef with breadcrumbs and egg', 'Bake meatloaf at 375Â°F for 40 min', 'Prepare mashed potatoes', 'Serve with green beans'], substitutes: ['Use turkey', 'Add ketchup glaze', 'Try sweet potato'] },
                    { name: 'ðŸ Carbonara', calories: 500, protein: 26, carbs: 52, fat: 18, time: 20, ingredients: ['1.5 cups pasta', '3 oz bacon', '2 eggs', 'parmesan', 'black pepper'], steps: ['Cook pasta', 'Crisp bacon', 'Mix eggs with cheese', 'Toss hot pasta with egg mixture and bacon'], substitutes: ['Use pancetta', 'Add peas', 'Try whole wheat pasta'] }
                ],
                snack: [
                    { name: 'ðŸŽ Apple & Almond Butter', calories: 200, protein: 6, carbs: 24, fat: 9, time: 2, ingredients: ['1 large apple', '2.5 tbsp almond butter'], steps: ['Slice apple into wedges', 'Serve with almond butter for dipping'], substitutes: ['Use peanut butter', 'Try banana', 'Add cinnamon'] },
                    { name: 'ðŸ¥œ Energy Trail Mix', calories: 200, protein: 7, carbs: 22, fat: 11, time: 1, ingredients: ['1/3 cup mixed nuts', '3 tbsp dried fruit', '1 tbsp dark chocolate chips'], steps: ['Mix all ingredients', 'Portion into small bags'], substitutes: ['Use seeds', 'Add coconut flakes', 'Try dried cranberries'] },
                    { name: 'ðŸ¥’ Veggie Platter', calories: 200, protein: 8, carbs: 20, fat: 10, time: 5, ingredients: ['1 cup carrots', '1 cup celery', '1/2 cup peppers', '1/3 cup hummus'], steps: ['Cut vegetables into sticks', 'Arrange on plate', 'Serve with hummus'], substitutes: ['Use guacamole', 'Add cucumber', 'Try tzatziki'] },
                    { name: 'ðŸª Peanut Butter Energy Balls', calories: 200, protein: 8, carbs: 24, fat: 9, time: 10, ingredients: ['2/3 cup oats', '3 tbsp peanut butter', '2 tbsp honey', '2 tbsp chocolate chips'], steps: ['Mix all ingredients in bowl', 'Roll into 6-8 balls', 'Refrigerate 30 minutes'], substitutes: ['Use almond butter', 'Add chia seeds', 'Try dates'] },
                    { name: 'ðŸ§€ Cheese & Whole Grain', calories: 200, protein: 14, carbs: 20, fat: 7, time: 2, ingredients: ['2 string cheese', '10 whole grain crackers'], steps: ['Arrange cheese and crackers on plate'], substitutes: ['Add grape tomatoes', 'Use cucumber', 'Try apple slices'] },
                    { name: 'ðŸ¥¤ Chocolate Protein Shake', calories: 200, protein: 20, carbs: 26, fat: 4, time: 5, ingredients: ['1 banana', '1 scoop chocolate protein', '1 cup milk', 'ice', '1 tbsp cocoa'], steps: ['Blend all ingredients', 'Add ice for thickness', 'Pour and enjoy'], substitutes: ['Add peanut butter', 'Use vanilla protein', 'Try oat milk'] },
                    { name: 'ðŸŠ Citrus & Nuts Combo', calories: 200, protein: 6, carbs: 22, fat: 10, time: 2, ingredients: ['1 orange', '18 almonds', '2 dates'], steps: ['Peel and section orange', 'Serve with almonds and dates'], substitutes: ['Use clementine', 'Try walnuts', 'Add dried apricots'] },
                    { name: 'ðŸ¥‘ Avocado Toast Mini', calories: 200, protein: 8, carbs: 22, fat: 10, time: 5, ingredients: ['1 slice bread', '1/2 avocado', 'everything bagel seasoning', 'cherry tomatoes'], steps: ['Toast bread', 'Mash avocado', 'Spread on toast', 'Top with tomatoes'], substitutes: ['Add egg', 'Use feta', 'Try hot sauce'] },
                    { name: 'ðŸ¥¤ Berry Smoothie', calories: 200, protein: 10, carbs: 32, fat: 4, time: 5, ingredients: ['1 cup berries', '1/2 cup yogurt', '1/2 cup milk', '1/2 banana'], steps: ['Blend all ingredients', 'Add ice if desired', 'Pour and enjoy'], substitutes: ['Add protein powder', 'Use almond milk', 'Try mango'] },
                    { name: 'ðŸ¥œ Peanut Butter Banana', calories: 200, protein: 7, carbs: 28, fat: 8, time: 2, ingredients: ['1 banana', '2 tbsp peanut butter'], steps: ['Slice banana', 'Spread or dip in peanut butter'], substitutes: ['Use almond butter', 'Add honey', 'Try apple'] },
                    { name: 'ðŸ¿ Popcorn Mix', calories: 200, protein: 5, carbs: 26, fat: 9, time: 5, ingredients: ['3 cups popcorn', '2 tbsp parmesan', '1 tbsp olive oil', 'herbs'], steps: ['Pop popcorn', 'Drizzle with oil', 'Toss with parmesan and herbs'], substitutes: ['Add nutritional yeast', 'Try butter', 'Use garlic powder'] },
                    { name: 'ðŸ¥š Hard Boiled Eggs & Fruit', calories: 200, protein: 12, carbs: 20, fat: 8, time: 15, ingredients: ['2 hard boiled eggs', '1 cup grapes'], steps: ['Boil eggs for 10 min', 'Cool and peel', 'Serve with grapes'], substitutes: ['Add crackers', 'Use cherry tomatoes', 'Try apple'] },
                    { name: 'ðŸ« Dark Chocolate & Almonds', calories: 200, protein: 6, carbs: 20, fat: 12, time: 1, ingredients: ['1 oz dark chocolate', '15 almonds'], steps: ['Break chocolate into pieces', 'Serve with almonds'], substitutes: ['Use milk chocolate', 'Try cashews', 'Add dried fruit'] },
                    { name: 'ðŸ¥¤ Green Smoothie', calories: 200, protein: 8, carbs: 32, fat: 5, time: 5, ingredients: ['1 cup spinach', '1 banana', '1/2 cup mango', '1 cup milk', 'ice'], steps: ['Blend all ingredients', 'Add ice for thickness'], substitutes: ['Use kale', 'Add protein powder', 'Try coconut milk'] },
                    { name: 'ðŸ§€ Caprese Skewers', calories: 200, protein: 12, carbs: 14, fat: 11, time: 5, ingredients: ['8 cherry tomatoes', '8 mozzarella balls', 'basil', 'balsamic glaze'], steps: ['Thread tomatoes and mozzarella on skewers', 'Add basil leaves', 'Drizzle with balsamic'], substitutes: ['Add prosciutto', 'Use pesto', 'Try olive oil'] },
                    { name: 'ðŸ¥œ Nut Butter Rice Cake', calories: 200, protein: 7, carbs: 24, fat: 9, time: 2, ingredients: ['2 rice cakes', '2 tbsp almond butter', '1/2 banana', 'cinnamon'], steps: ['Spread almond butter on rice cakes', 'Top with banana slices', 'Sprinkle cinnamon'], substitutes: ['Use peanut butter', 'Add honey', 'Try berries'] },
                    { name: 'ðŸ¥¤ Protein Coffee', calories: 200, protein: 18, carbs: 22, fat: 5, time: 5, ingredients: ['1 cup cold brew', '1 scoop protein powder', '1/2 cup milk', 'ice'], steps: ['Blend coffee with protein and milk', 'Add ice', 'Pour and enjoy'], substitutes: ['Add cocoa', 'Use vanilla protein', 'Try almond milk'] },
                    { name: 'ðŸ‡ Greek Yogurt & Fruit', calories: 200, protein: 16, carbs: 28, fat: 4, time: 2, ingredients: ['1 cup Greek yogurt', '1 cup mixed berries', '1 tbsp honey'], steps: ['Place yogurt in bowl', 'Top with berries', 'Drizzle honey'], substitutes: ['Add granola', 'Use banana', 'Try nuts'] },
                    { name: 'ðŸ¥™ Mini Hummus Wrap', calories: 200, protein: 8, carbs: 26, fat: 8, time: 5, ingredients: ['1 small tortilla', '1/4 cup hummus', 'cucumber', 'tomato', 'lettuce'], steps: ['Spread hummus on tortilla', 'Add vegetables', 'Roll and slice'], substitutes: ['Add feta', 'Use spinach', 'Try tzatziki'] },
                    { name: 'ðŸŒ Banana Nice Cream', calories: 200, protein: 6, carbs: 36, fat: 5, time: 5, ingredients: ['2 frozen bananas', '2 tbsp peanut butter', 'cocoa powder', 'milk'], steps: ['Blend frozen bananas', 'Add peanut butter and cocoa', 'Blend until smooth'], substitutes: ['Add berries', 'Use almond butter', 'Try vanilla'] }
                ]
            };

            // Meal timing configuration (in hours)
            const mealTimings = {
                breakfast: { next: 'lunch', hours: 4 },
                lunch: { next: 'snack', hours: 3 },
                snack: { next: 'dinner', hours: 3 },
                dinner: { next: null, hours: 0 }
            };

            // Function to get random meal from category
            const getRandomMeal = (category) => {
                const meals = mealDatabase[category];
                return meals[Math.floor(Math.random() * meals.length)];
            };

            // Initialize week meals from database
            useEffect(() => {
                const savedMeals = localStorage.getItem('week-meals');
                if (savedMeals) {
                    setWeekMeals(JSON.parse(savedMeals));
                } else {
                    // Generate random meals for each day
                    const initialMeals = {};
                    for (let day = 1; day <= 7; day++) {
                        initialMeals[`day${day}`] = {
                            breakfast: getRandomMeal('breakfast'),
                            lunch: getRandomMeal('lunch'),
                            dinner: getRandomMeal('dinner'),
                            snack: getRandomMeal('snack')
                        };
                    }
                    setWeekMeals(initialMeals);
                    localStorage.setItem('week-meals', JSON.stringify(initialMeals));
                }

                // Load progress from localStorage
                const savedProgress = {};
                const savedNextMealTimers = {};
                for (let day = 1; day <= 7; day++) {
                    const dayKey = `day${day}`;
                    const storedProgress = localStorage.getItem(`progress-${dayKey}`);
                    if (storedProgress) {
                        savedProgress[dayKey] = JSON.parse(storedProgress);
                    } else {
                        savedProgress[dayKey] = {
                            breakfast: false,
                            lunch: false,
                            dinner: false,
                            snack: false,
                            extra: 0
                        };
                    }

                    const storedTimers = localStorage.getItem(`next-meal-timer-${dayKey}`);
                    if (storedTimers) {
                        savedNextMealTimers[dayKey] = JSON.parse(storedTimers);
                    }
                }
                setProgress(savedProgress);
                setNextMealTimers(savedNextMealTimers);
            }, []);

            // Save weekMeals to localStorage
            useEffect(() => {
                if (Object.keys(weekMeals).length > 0) {
                    localStorage.setItem('week-meals', JSON.stringify(weekMeals));
                }
            }, [weekMeals]);

            // Save progress to localStorage
            useEffect(() => {
                Object.keys(progress).forEach(dayKey => {
                    localStorage.setItem(`progress-${dayKey}`, JSON.stringify(progress[dayKey]));
                });
            }, [progress]);

            // Save next meal timers to localStorage
            useEffect(() => {
                Object.keys(nextMealTimers).forEach(dayKey => {
                    localStorage.setItem(`next-meal-timer-${dayKey}`, JSON.stringify(nextMealTimers[dayKey]));
                });
            }, [nextMealTimers]);

            // Update next meal timers every second
            useEffect(() => {
                const interval = setInterval(() => {
                    setNextMealTimers(prev => {
                        const updated = { ...prev };
                        let changed = false;

                        Object.keys(updated).forEach(dayKey => {
                            Object.keys(updated[dayKey] || {}).forEach(mealType => {
                                if (updated[dayKey][mealType] && updated[dayKey][mealType].endTime) {
                                    const remaining = updated[dayKey][mealType].endTime - Date.now();
                                    if (remaining <= 0) {
                                        delete updated[dayKey][mealType];
                                        changed = true;
                                    }
                                }
                            });
                        });

                        return changed ? updated : prev;
                    });
                }, 1000);

                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const theme = themes[currentTheme];
            const dayKey = `day${currentDay}`;
            const meals = weekMeals[dayKey] || {};
            const dayProgress = progress[dayKey] || { breakfast: false, lunch: false, dinner: false, snack: false, extra: 0 };

            const totalConsumed = 
                (dayProgress.breakfast ? meals.breakfast?.calories || 0 : 0) +
                (dayProgress.lunch ? meals.lunch?.calories || 0 : 0) +
                (dayProgress.dinner ? meals.dinner?.calories || 0 : 0) +
                (dayProgress.snack ? meals.snack?.calories || 0 : 0) +
                dayProgress.extra;

            const totalProtein = 
                (dayProgress.breakfast ? meals.breakfast?.protein || 0 : 0) +
                (dayProgress.lunch ? meals.lunch?.protein || 0 : 0) +
                (dayProgress.dinner ? meals.dinner?.protein || 0 : 0) +
                (dayProgress.snack ? meals.snack?.protein || 0 : 0);

            const regenerateMeal = (mealType) => {
                // Get a new random meal from the category
                const newMeal = getRandomMeal(mealType);
                
                setWeekMeals(prev => ({
                    ...prev,
                    [dayKey]: {
                        ...prev[dayKey],
                        [mealType]: newMeal
                    }
                }));
            };

            const toggleMeal = (mealType) => {
                const isCurrentlyChecked = dayProgress[mealType];
                
                setProgress(prev => ({
                    ...prev,
                    [dayKey]: {
                        ...prev[dayKey],
                        [mealType]: !prev[dayKey][mealType]
                    }
                }));

                if (!isCurrentlyChecked && mealTimings[mealType]?.next) {
                    const nextMealType = mealTimings[mealType].next;
                    const hours = mealTimings[mealType].hours;
                    const endTime = Date.now() + (hours * 60 * 60 * 1000);

                    setNextMealTimers(prev => ({
                        ...prev,
                        [dayKey]: {
                            ...prev[dayKey],
                            [nextMealType]: {
                                endTime: endTime,
                                hours: hours
                            }
                        }
                    }));
                }
            };

            const formatCountdown = (endTime) => {
                const remaining = endTime - Date.now();
                if (remaining <= 0) return "Ready!";

                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            };

            const handleOverate = () => {
                const calories = parseInt(extraCalories);
                if (calories > 0) {
                    setProgress(prev => ({
                        ...prev,
                        [dayKey]: {
                            ...prev[dayKey],
                            extra: prev[dayKey].extra + calories
                        }
                    }));
                    setExtraCalories('');
                    setOvereatingModal(null);
                }
            };

            const resetDayProgress = () => {
                if (confirm('Reset all progress for this day?')) {
                    setProgress(prev => ({
                        ...prev,
                        [dayKey]: {
                            breakfast: false,
                            lunch: false,
                            dinner: false,
                            snack: false,
                            extra: 0
                        }
                    }));
                    
                    setNextMealTimers(prev => ({
                        ...prev,
                        [dayKey]: {}
                    }));
                }
            };

            const generateShoppingList = () => {
                const parseIngredient = (ingredient) => {
                    const fractionMap = { '1/2': 0.5, '1/3': 0.33, '2/3': 0.67, '1/4': 0.25, '3/4': 0.75, '1/8': 0.125 };
                    
                    const match = ingredient.match(/^([\d\/]+)\s*(oz|g|cup|cups|tbsp|tsp|ml|l|kg|lb|lbs)?\s+(.+)$/i);
                    
                    if (match) {
                        let amount = match[1];
                        if (fractionMap[amount]) {
                            amount = fractionMap[amount];
                        } else {
                            amount = parseFloat(amount) || 1;
                        }
                        
                        const unit = match[2] ? match[2].toLowerCase() : 'piece';
                        const product = match[3].trim().toLowerCase();
                        
                        return { amount, unit, product, original: ingredient };
                    }
                    
                    return { amount: 1, unit: 'piece', product: ingredient.toLowerCase(), original: ingredient };
                };
                
                const ingredientsMap = {};
                
                Object.keys(weekMeals).forEach(day => {
                    const dayMeals = weekMeals[day];
                    ['breakfast', 'lunch', 'dinner', 'snack'].forEach(mealType => {
                        const meal = dayMeals[mealType];
                        if (meal && meal.ingredients) {
                            meal.ingredients.forEach(ingredient => {
                                const parsed = parseIngredient(ingredient);
                                const key = `${parsed.product}_${parsed.unit}`;
                                
                                if (ingredientsMap[key]) {
                                    ingredientsMap[key].totalAmount += parsed.amount;
                                    ingredientsMap[key].count++;
                                    if (!ingredientsMap[key].meals.includes(meal.name)) {
                                        ingredientsMap[key].meals.push(meal.name);
                                    }
                                } else {
                                    ingredientsMap[key] = {
                                        product: parsed.product,
                                        unit: parsed.unit,
                                        originalAmount: parsed.amount,
                                        totalAmount: parsed.amount,
                                        count: 1,
                                        meals: [meal.name],
                                        original: parsed.original
                                    };
                                }
                            });
                        }
                    });
                });
                
                const list = Object.values(ingredientsMap).map(item => {
                    const productName = item.product.charAt(0).toUpperCase() + item.product.slice(1);
                    
                    return {
                        name: productName,
                        originalAmount: item.originalAmount,
                        totalAmount: Math.round(item.totalAmount * 100) / 100,
                        unit: item.unit,
                        count: item.count,
                        meal: item.meals.join(', ')
                    };
                });
                
                setShoppingList(list);
                setShowShoppingList(true);
            };

            const downloadShoppingList = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf', 'Roboto', 'normal');
                doc.setFont('Roboto');
                
                doc.setFillColor(147, 51, 234);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.text('Shopping List', 20, 25);
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(12);
                
                let yPos = 55;
                
                shoppingList.forEach((item, i) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFillColor(243, 244, 246);
                    const boxHeight = item.count > 1 ? 20 : 15;
                    doc.rect(15, yPos - 5, 180, boxHeight, 'F');
                    
                    doc.setFontSize(14);
                    doc.setFont('Roboto', 'bold');
                    doc.text(item.name, 20, yPos);
                    
                    doc.setFont('Roboto', 'normal');
                    doc.setFontSize(11);
                    doc.setTextColor(37, 99, 235);
                    
                    if (item.count > 1) {
                        doc.text(`${item.originalAmount} ${item.unit} x ${item.count} times = ${item.totalAmount} ${item.unit} total`, 20, yPos + 6);
                        doc.setTextColor(107, 114, 128);
                        doc.setFontSize(10);
                        doc.text(`For: ${item.meal}`, 20, yPos + 11);
                        yPos += boxHeight + 5;
                    } else {
                        doc.text(`${item.totalAmount} ${item.unit}`, 20, yPos + 5);
                        doc.setTextColor(107, 114, 128);
                        doc.setFontSize(10);
                        doc.text(`For: ${item.meal}`, 20, yPos + 10);
                        yPos += boxHeight + 5;
                    }
                    
                    doc.setTextColor(0, 0, 0);
                });
                
                doc.save('shopping-list.pdf');
            };

            const downloadMealPlan = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf', 'Roboto', 'normal');
                doc.setFont('Roboto');
                
                doc.setFillColor(147, 51, 234);
                doc.rect(0, 0, 210, 45, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(26);
                doc.text('Weekly Meal Plan', 20, 25);
                doc.setFontSize(14);
                doc.text('1500 Calorie Daily Target', 20, 35);
                
                let yPos = 60;
                
                daysOfWeek.forEach((day, index) => {
                    const dayKey = `day${index + 1}`;
                    const dayMeals = weekMeals[dayKey];
                    
                    if (!dayMeals) return;
                    
                    if (yPos > 240) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    const dayColors = [
                        [196, 181, 253],
                        [191, 219, 254],
                        [187, 247, 208],
                        [254, 240, 138],
                        [254, 215, 170],
                        [251, 207, 232],
                        [254, 202, 202]
                    ];
                    
                    doc.setFillColor(...dayColors[index]);
                    doc.rect(15, yPos - 7, 180, 12, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(16);
                    doc.text(day.name, 20, yPos);
                    yPos += 15;
                    
                    const mealTypes = [
                        { key: 'breakfast', label: 'Breakfast' },
                        { key: 'lunch', label: 'Lunch' },
                        { key: 'dinner', label: 'Dinner' },
                        { key: 'snack', label: 'Snack' }
                    ];
                    
                    mealTypes.forEach(mealType => {
                        const meal = dayMeals[mealType.key];
                        if (meal) {
                            doc.setFillColor(249, 250, 251);
                            doc.rect(20, yPos - 5, 170, 18, 'F');
                            
                            doc.setFontSize(12);
                            doc.setTextColor(0, 0, 0);
                            doc.text(`${mealType.label}`, 25, yPos);
                            
                            doc.text(meal.name, 25, yPos + 6);
                            
                            doc.setTextColor(107, 114, 128);
                            doc.setFontSize(10);
                            doc.text(`${meal.calories} cal | P: ${meal.protein}g | C: ${meal.carbs}g | F: ${meal.fat}g`, 25, yPos + 11);
                            
                            yPos += 23;
                        }
                    });
                    
                    yPos += 5;
                });
                
                doc.save('meal-plan.pdf');
            };

            const getMealLabel = (mealType) => {
                const labels = {
                    breakfast: 'BREAKFAST',
                    lunch: 'LUNCH',
                    snack: 'SNACK',
                    dinner: 'DINNER'
                };
                return labels[mealType] || mealType.toUpperCase();
            };

            const MealCard = ({ meal, mealType, onRegenerate, onToggle, onShowRecipe, isChecked, nextMealTimer }) => {
                
                return (
                    <div className={`${darkMode ? 'bg-gray-800' : theme.card} backdrop-blur-md rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-xl border ${darkMode ? 'border-gray-700' : theme.border} transition-all hover:shadow-2xl`}>
                        {/* Meal Type Label */}
                        <div className={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-3 ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'}`}>
                            {getMealLabel(mealType)}
                        </div>

                        <div className="flex items-start justify-between mb-3 md:mb-4">
                            <div className="flex-1 min-w-0">
                                <h3 className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text} mb-1 md:mb-2 break-words`}>{meal.name}</h3>
                                <div className={`flex flex-wrap gap-1.5 md:gap-2 text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                    <span className="whitespace-nowrap">ðŸ”¥ {meal.calories} cal</span>
                                    <span className="whitespace-nowrap">ðŸ’ª {meal.protein}g protein</span>
                                    <span className="whitespace-nowrap">â±ï¸ {meal.time} min</span>
                                </div>
                            </div>
                            <button
                                onClick={() => onToggle(mealType)}
                                className={`ml-2 md:ml-3 w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center transition-all shrink-0 ${
                                    isChecked 
                                        ? `${theme.accent} text-white shadow-lg` 
                                        : `${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`
                                }`}
                            >
                                {isChecked && <span className="text-sm md:text-base">âœ“</span>}
                            </button>
                        </div>

                        {nextMealTimer && nextMealTimer.endTime && (
                            <div className={`mb-3 md:mb-4 p-2 md:p-3 rounded-xl ${darkMode ? 'bg-blue-900/30 border border-blue-700' : 'bg-blue-50 border border-blue-200'}`}>
                                <div className={`text-xs md:text-sm ${darkMode ? 'text-blue-300' : 'text-blue-700'} font-medium mb-1`}>
                                    Time until next meal:
                                </div>
                                <div className={`text-lg md:text-2xl font-bold ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>
                                    {formatCountdown(nextMealTimer.endTime)}
                                </div>
                            </div>
                        )}

                        <div className="flex flex-wrap gap-2 mb-3 md:mb-4">
                            {['Carbs', 'Fat'].map((nutrient, i) => {
                                const value = i === 0 ? meal.carbs : meal.fat;
                                return (
                                    <div key={nutrient} className={`${darkMode ? 'bg-gray-700' : 'bg-white/50'} px-2 md:px-3 py-1 md:py-1.5 rounded-lg text-xs md:text-sm`}>
                                        <span className={darkMode ? 'text-gray-300' : 'text-gray-600'}>{nutrient}:</span>
                                        <span className={`font-semibold ml-1 ${darkMode ? 'text-white' : theme.text}`}>{value}g</span>
                                    </div>
                                );
                            })}
                        </div>

                        <div className="flex flex-wrap gap-2">
                            <button
                                onClick={() => onShowRecipe(meal)}
                                className={`flex-1 min-w-[100px] ${theme.accent} ${theme.accentHover} text-white px-3 md:px-4 py-2 md:py-2.5 rounded-xl font-medium transition-all shadow-lg text-sm md:text-base`}
                            >
                                ðŸ“– Recipe
                            </button>
                            <button
                                onClick={() => onRegenerate(mealType)}
                                disabled={isChecked}
                                className={`px-3 md:px-4 py-2 md:py-2.5 rounded-xl font-medium transition-all text-sm md:text-base min-w-[44px] ${
                                    isChecked 
                                        ? `${darkMode ? 'bg-gray-800 text-gray-600' : 'bg-gray-200 text-gray-400'} cursor-not-allowed opacity-50`
                                        : `${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-blue-100 hover:bg-blue-200 text-blue-700'}`
                                }`}
                            >
                                <RefreshCw className="w-4 h-4 md:w-5 md:h-5" />
                            </button>
                        </div>
                    </div>
                );
            };

            return (
                <div className={`min-h-screen bg-gradient-to-br ${darkMode ? 'from-gray-900 to-gray-800' : theme.bg} py-4 md:py-8 px-3 md:px-6 transition-colors duration-300`}>
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className={`${darkMode ? 'bg-gray-800/90' : theme.card} backdrop-blur-md rounded-2xl md:rounded-3xl p-4 md:p-8 mb-4 md:mb-6 shadow-2xl border ${darkMode ? 'border-gray-700' : theme.border}`}>
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4 md:mb-6">
                                <div className="flex-1 min-w-0">
                                    <h1 className={`text-3xl md:text-5xl font-bold ${darkMode ? 'text-white' : theme.text} mb-1 md:mb-2 break-words`}>
                                        ðŸ½ï¸ 1500 Calorie Meal Planner
                                    </h1>
                                    <p className={`text-sm md:text-lg ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                        {currentTime.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                                    </p>
                                </div>
                                <div className="flex gap-2 w-full md:w-auto">
                                    <button
                                        onClick={() => setCurrentTheme((currentTheme + 1) % themes.length)}
                                        className={`flex-1 md:flex-none ${theme.accent} ${theme.accentHover} text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all shadow-lg text-sm md:text-base min-h-[44px]`}
                                    >
                                        ðŸŽ¨ Theme
                                    </button>
                                    <button
                                        onClick={() => setDarkMode(!darkMode)}
                                        className={`flex-1 md:flex-none ${darkMode ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-indigo-500 hover:bg-indigo-600'} text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all shadow-lg text-sm md:text-base flex items-center justify-center gap-2 min-h-[44px]`}
                                    >
                                        {darkMode ? <Sun className="w-4 h-4 md:w-5 md:h-5" /> : <Moon className="w-4 h-4 md:w-5 md:h-5" />}
                                        <span className="hidden md:inline">{darkMode ? 'Light' : 'Dark'}</span>
                                    </button>
                                </div>
                            </div>

                            {/* Navigation */}
                            <div className="flex gap-2 md:gap-4 mb-4 md:mb-6 overflow-x-auto pb-2">
                                <button
                                    onClick={() => setCurrentPage('meals')}
                                    className={`flex items-center gap-1.5 md:gap-2 px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all whitespace-nowrap text-sm md:text-base min-h-[44px] ${
                                        currentPage === 'meals'
                                            ? `${theme.accent} text-white shadow-lg`
                                            : `${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-white/50 hover:bg-white/80 text-gray-700'}`
                                    }`}
                                >
                                    <Home className="w-4 h-4 md:w-5 md:h-5" />
                                    <span>Meals</span>
                                </button>
                                <button
                                    onClick={() => setCurrentPage('overview')}
                                    className={`flex items-center gap-1.5 md:gap-2 px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all whitespace-nowrap text-sm md:text-base min-h-[44px] ${
                                        currentPage === 'overview'
                                            ? `${theme.accent} text-white shadow-lg`
                                            : `${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-white/50 hover:bg-white/80 text-gray-700'}`
                                    }`}
                                >
                                    <List className="w-4 h-4 md:w-5 md:h-5" />
                                    <span>Week Overview</span>
                                </button>
                            </div>

                            {/* Day selector */}
                            {currentPage === 'meals' && (
                                <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-2 md:gap-3">
                                    {daysOfWeek.map((day, index) => (
                                        <button
                                            key={day.name}
                                            onClick={() => setCurrentDay(index + 1)}
                                            className={`px-3 md:px-4 py-2 md:py-3 rounded-xl font-medium transition-all border-2 text-sm md:text-base min-h-[44px] ${
                                                currentDay === index + 1
                                                    ? `${day.activeColor} shadow-lg transform scale-105`
                                                    : `${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white border-gray-600' : day.color}`
                                            }`}
                                        >
                                            {day.name}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>

                        {currentPage === 'meals' ? (
                            <>
                                {/* Progress Card */}
                                <div className={`${darkMode ? 'bg-gray-800/90' : theme.card} backdrop-blur-md rounded-2xl md:rounded-3xl p-4 md:p-6 mb-4 md:mb-6 shadow-xl border ${darkMode ? 'border-gray-700' : theme.border}`}>
                                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 md:gap-4 mb-3 md:mb-4">
                                        <div className="flex-1 min-w-0">
                                            <h2 className={`text-xl md:text-2xl font-bold ${darkMode ? 'text-white' : theme.text} mb-1 md:mb-2`}>Today's Progress</h2>
                                            <div className={`text-2xl md:text-4xl font-bold ${darkMode ? 'text-white' : theme.text}`}>
                                                {totalConsumed} <span className={`text-base md:text-xl ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>/ 1500 cal</span>
                                            </div>
                                        </div>
                                        <div className="flex flex-wrap gap-2 w-full sm:w-auto">
                                            <button
                                                onClick={resetDayProgress}
                                                className="flex-1 sm:flex-none bg-red-500 hover:bg-red-600 text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all shadow-lg text-sm md:text-base whitespace-nowrap min-h-[44px]"
                                            >
                                                ðŸ”„ Reset Progress
                                            </button>
                                            <button
                                                onClick={() => setOvereatingModal(dayKey)}
                                                className="flex-1 sm:flex-none bg-orange-400 hover:bg-orange-500 text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all shadow-lg text-sm md:text-base whitespace-nowrap min-h-[44px]"
                                            >
                                                âž• Extra Calories
                                            </button>
                                            <button
                                                onClick={downloadMealPlan}
                                                className={`flex-1 sm:flex-none ${theme.accent} ${theme.accentHover} text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-medium transition-all shadow-lg flex items-center justify-center gap-1.5 md:gap-2 text-sm md:text-base min-h-[44px]`}
                                            >
                                                <Download className="w-4 h-4 md:w-5 md:h-5" />
                                                <span>Download</span>
                                            </button>
                                        </div>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full h-3 md:h-4 mb-3 md:mb-4 overflow-hidden`}>
                                        <div
                                            className={`${totalConsumed > 1500 ? 'bg-red-500' : theme.accent.replace('bg-', 'bg-')} h-full transition-all duration-500 rounded-full`}
                                            style={{ width: `${Math.min((totalConsumed / 1500) * 100, 100)}%` }}
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-2 md:gap-3">
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-white/50'} p-2 md:p-3 rounded-xl`}>
                                            <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Protein</div>
                                            <div className={`text-lg md:text-2xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{totalProtein}g</div>
                                        </div>
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-white/50'} p-2 md:p-3 rounded-xl`}>
                                            <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Remaining</div>
                                            <div className={`text-lg md:text-2xl font-bold ${totalConsumed > 1500 ? 'text-red-500' : (darkMode ? 'text-green-400' : 'text-green-600')}`}>
                                                {Math.max(0, 1500 - totalConsumed)} cal
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Extra meal today button */}
                                <div className="mb-4 md:mb-6">
                                    <button
                                        onClick={() => setOvereatingModal(dayKey)}
                                        className={`w-full ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200'} ${darkMode ? 'text-white' : 'text-purple-700'} px-4 md:px-6 py-3 md:py-4 rounded-xl font-medium transition-all shadow-lg flex items-center justify-center gap-2 text-sm md:text-base min-h-[44px] border-2 ${darkMode ? 'border-gray-600' : 'border-purple-300'}`}
                                    >
                                        <Plus className="w-5 h-5 md:w-6 md:h-6" />
                                        <span>Extra meal today</span>
                                    </button>
                                </div>

                                {/* Meal Cards */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-6">
                                    {['breakfast', 'lunch', 'snack', 'dinner'].map(mealType => {
                                        const meal = meals[mealType];
                                        if (!meal) return null;
                                        
                                        const nextMealTimer = nextMealTimers[dayKey]?.[mealType];
                                        
                                        return (
                                            <MealCard
                                                key={mealType}
                                                meal={meal}
                                                mealType={mealType}
                                                onRegenerate={regenerateMeal}
                                                onToggle={toggleMeal}
                                                onShowRecipe={setShowRecipe}
                                                isChecked={dayProgress[mealType]}
                                                nextMealTimer={nextMealTimer}
                                            />
                                        );
                                    })}
                                </div>
                            </>
                        ) : (
                            /* Week Overview */
                            <div className="space-y-3 md:space-y-4">
                                <div className={`${darkMode ? 'bg-gray-800/90' : theme.card} backdrop-blur-md rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-xl border ${darkMode ? 'border-gray-700' : theme.border}`}>
                                    <button
                                        onClick={generateShoppingList}
                                        className={`w-full ${theme.accent} ${theme.accentHover} text-white px-4 md:px-6 py-3 md:py-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 md:gap-3 shadow-lg text-base md:text-lg mb-4 md:mb-6 min-h-[44px]`}
                                    >
                                        <ShoppingCart className="w-5 h-5 md:w-6 md:h-6" />
                                        <span>Generate Shopping List</span>
                                    </button>

                                    {daysOfWeek.map((day, index) => {
                                        const dayKey = `day${index + 1}`;
                                        const dayMeals = weekMeals[dayKey];
                                        const dayProg = progress[dayKey] || {};
                                        
                                        if (!dayMeals) return null;

                                        const dayTotal = 
                                            (dayProg.breakfast ? dayMeals.breakfast?.calories || 0 : 0) +
                                            (dayProg.lunch ? dayMeals.lunch?.calories || 0 : 0) +
                                            (dayProg.dinner ? dayMeals.dinner?.calories || 0 : 0) +
                                            (dayProg.snack ? dayMeals.snack?.calories || 0 : 0) +
                                            (dayProg.extra || 0);

                                        return (
                                            <div key={day.name} className={`mb-3 md:mb-4 p-3 md:p-4 ${darkMode ? 'bg-gray-700' : 'bg-white/50'} rounded-xl`}>
                                                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-2 md:mb-3">
                                                    <h3 className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{day.name}</h3>
                                                    <div className={`text-base md:text-lg font-semibold ${darkMode ? 'text-white' : theme.text}`}>
                                                        {dayTotal} / 1500 cal
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                    {[
                                                        { key: 'breakfast', icon: 'ðŸ³', label: 'Breakfast' },
                                                        { key: 'lunch', icon: 'ðŸ¥—', label: 'Lunch' },
                                                        { key: 'dinner', icon: 'ðŸ½ï¸', label: 'Dinner' },
                                                        { key: 'snack', icon: 'ðŸŽ', label: 'Snack' }
                                                    ].map(mealType => {
                                                        const meal = dayMeals[mealType.key];
                                                        if (!meal) return null;
                                                        
                                                        return (
                                                            <div key={mealType.key} className={`p-2 md:p-3 ${darkMode ? 'bg-gray-600' : 'bg-white/70'} rounded-lg`}>
                                                                <div className={`font-medium ${darkMode ? 'text-white' : 'text-gray-800'} text-sm md:text-base`}>
                                                                    {mealType.icon} {mealType.label}
                                                                </div>
                                                                <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'} break-words`}>{meal.name}</div>
                                                                <div className={`text-xs md:text-sm font-semibold ${darkMode ? 'text-gray-200' : theme.text}`}>{meal.calories} cal</div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Recipe Modal */}
                    {showRecipe && (
                        <div 
                            className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto modal-overlay" 
                            onClick={() => setShowRecipe(null)}
                        >
                            <div className="min-h-screen flex items-center justify-center p-2 md:p-4 py-8">
                                <div 
                                    className={`${darkMode ? 'bg-gray-800' : theme.card} backdrop-blur-md rounded-2xl md:rounded-3xl shadow-2xl max-w-2xl w-full my-auto p-4 md:p-6 border ${darkMode ? 'border-gray-700' : theme.border}`} 
                                    onClick={e => e.stopPropagation()}
                                >
                                    <div className="flex justify-between items-start mb-3 md:mb-4 sticky top-0 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm pb-2 z-10">
                                        <h2 className={`text-xl md:text-2xl font-bold ${darkMode ? 'text-white' : theme.text} pr-2 break-words`}>{showRecipe.name}</h2>
                                        <button 
                                            onClick={() => setShowRecipe(null)} 
                                            className={`${darkMode ? 'text-gray-400 hover:text-gray-200' : 'text-gray-500 hover:text-gray-700'} p-1 shrink-0 min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                        >
                                            <X className="w-5 h-5 md:w-6 md:h-6" />
                                        </button>
                                    </div>

                                    <div className="space-y-3 md:space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar">
                                        <div className={`grid grid-cols-2 gap-2 p-3 md:p-4 ${darkMode ? 'bg-gray-700' : 'bg-white/50'} rounded-xl`}>
                                            <div>
                                                <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Calories</div>
                                                <div className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{showRecipe.calories}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Protein</div>
                                                <div className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{showRecipe.protein}g</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Carbs</div>
                                                <div className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{showRecipe.carbs}g</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Fat</div>
                                                <div className={`text-lg md:text-xl font-bold ${darkMode ? 'text-white' : theme.text}`}>{showRecipe.fat}g</div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className={`text-base md:text-lg font-bold ${darkMode ? 'text-white' : theme.text} mb-2`}>ðŸ“ Ingredients</h3>
                                            <ul className="space-y-1.5 md:space-y-2">
                                                {showRecipe.ingredients.map((ing, i) => (
                                                    <li key={i} className="flex items-start gap-2">
                                                        <span className={`${darkMode ? 'text-purple-400' : 'text-purple-500'} mt-0.5 shrink-0`}>â€¢</span>
                                                        <span className={`${darkMode ? 'text-gray-300' : 'text-gray-700'} text-sm md:text-base break-words`}>{ing}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>

                                        <div>
                                            <h3 className={`text-base md:text-lg font-bold ${darkMode ? 'text-white' : theme.text} mb-2`}>ðŸ‘¨â€ðŸ³ Instructions</h3>
                                            <ol className="space-y-1.5 md:space-y-2">
                                                {showRecipe.steps.map((step, i) => (
                                                    <li key={i} className="flex items-start gap-2 md:gap-3">
                                                        <span className={`${theme.accent} text-white rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center text-xs md:text-sm font-bold shrink-0 mt-0.5`}>
                                                            {i + 1}
                                                        </span>
                                                        <span className={`${darkMode ? 'text-gray-300' : 'text-gray-700'} text-sm md:text-base break-words`}>{step}</span>
                                                    </li>
                                                ))}
                                            </ol>
                                        </div>

                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} p-3 md:p-4 rounded-xl`}>
                                            <h3 className={`text-base md:text-lg font-bold ${darkMode ? 'text-white' : 'text-blue-900'} mb-2`}>ðŸ’¡ Substitutions</h3>
                                            <ul className="space-y-1.5 md:space-y-2">
                                                {showRecipe.substitutes.map((sub, i) => (
                                                    <li key={i} className="flex items-start gap-2 text-sm md:text-base">
                                                        <span className={`${darkMode ? 'text-blue-400' : 'text-blue-500'} mt-0.5 shrink-0`}>â†’</span>
                                                        <span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>{sub}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>

                                    <div className="pt-2">
                                        <button
                                            onClick={() => setShowRecipe(null)}
                                            className={`w-full ${theme.accent} ${theme.accentHover} text-white px-4 py-3 rounded-xl font-medium transition-all shadow-lg min-h-[44px]`}
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Overeating Modal */}
                    {overeatingModal !== null && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setOvereatingModal(null)}>
                            <div className={`${darkMode ? 'bg-gray-800' : theme.card} rounded-2xl md:rounded-3xl shadow-2xl max-w-md w-full p-4 md:p-6 border ${darkMode ? 'border-gray-700' : ''}`} onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-start mb-4">
                                    <h2 className={`text-xl md:text-2xl font-bold ${darkMode ? 'text-white' : theme.text}`}>Add Extra Calories</h2>
                                    <button onClick={() => setOvereatingModal(null)} className={`${darkMode ? 'text-gray-400 hover:text-gray-200' : 'text-gray-500 hover:text-gray-700'} min-h-[44px] min-w-[44px] flex items-center justify-center`}>
                                        <X className="w-5 h-5 md:w-6 md:h-6" />
                                    </button>
                                </div>

                                <div className="space-y-3 md:space-y-4">
                                    <input
                                        type="number"
                                        value={extraCalories}
                                        onChange={(e) => setExtraCalories(e.target.value)}
                                        placeholder="Enter calories"
                                        className={`w-full px-4 py-3 rounded-xl border-2 focus:outline-none text-base md:text-lg min-h-[44px] ${
                                            darkMode 
                                                ? 'bg-gray-700 border-gray-600 text-white focus:border-orange-400' 
                                                : 'border-gray-300 focus:border-orange-400'
                                        }`}
                                    />
                                    <button
                                        onClick={handleOverate}
                                        className="w-full bg-orange-400 hover:bg-orange-500 text-white px-6 py-3 rounded-xl font-medium transition-all text-base md:text-lg shadow-lg min-h-[44px]"
                                    >
                                        Add Calories
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Shopping List Modal */}
                    {showShoppingList && (
                        <div 
                            className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 overflow-y-auto modal-overlay" 
                            onClick={() => setShowShoppingList(false)}
                        >
                            <div className="min-h-screen flex items-center justify-center p-2 md:p-4 py-8">
                                <div 
                                    className={`${darkMode ? 'bg-gray-800' : theme.card} rounded-2xl md:rounded-3xl shadow-2xl max-w-2xl w-full my-auto p-4 md:p-6 border ${darkMode ? 'border-gray-700' : ''}`} 
                                    onClick={e => e.stopPropagation()}
                                >
                                    <div className={`flex justify-between items-start mb-3 md:mb-4 sticky top-0 ${darkMode ? 'bg-gray-800/95' : 'bg-white/95'} backdrop-blur-sm pb-2 z-10`}>
                                        <h2 className={`text-xl md:text-2xl font-bold ${darkMode ? 'text-white' : theme.text}`}>ðŸ›’ Shopping List</h2>
                                        <button 
                                            onClick={() => setShowShoppingList(false)} 
                                            className={`${darkMode ? 'text-gray-400 hover:text-gray-200' : 'text-gray-500 hover:text-gray-700'} p-1 min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                        >
                                            <X className="w-5 h-5 md:w-6 md:h-6" />
                                        </button>
                                    </div>

                                    <div className="space-y-2 mb-4 max-h-[50vh] overflow-y-auto custom-scrollbar">
                                        {shoppingList.map((item, i) => (
                                            <div key={i} className={`flex items-start gap-2 md:gap-3 p-3 md:p-4 ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg border ${darkMode ? 'border-gray-600' : 'border-gray-200'}`}>
                                                <span className={`${darkMode ? 'text-green-400' : 'text-green-500'} mt-0.5 text-base md:text-lg shrink-0`}>âœ“</span>
                                                <div className="min-w-0 flex-1">
                                                    <div className={`font-bold ${darkMode ? 'text-white' : 'text-gray-900'} text-base md:text-lg mb-1`}>
                                                        {item.name}
                                                    </div>
                                                    {item.count > 1 ? (
                                                        <div className={`${darkMode ? 'text-blue-300' : 'text-blue-600'} text-sm md:text-base font-medium mb-1`}>
                                                            {item.originalAmount} {item.unit} Ã— {item.count} times = {item.totalAmount} {item.unit} total
                                                        </div>
                                                    ) : (
                                                        <div className={`${darkMode ? 'text-blue-300' : 'text-blue-600'} text-sm md:text-base font-medium mb-1`}>
                                                            {item.totalAmount} {item.unit}
                                                        </div>
                                                    )}
                                                    <div className={`text-xs md:text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                                        For: {item.meal}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="flex gap-2 md:gap-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                        <button
                                            onClick={downloadShoppingList}
                                            className={`flex-1 ${theme.accent} ${theme.accentHover} text-white px-4 py-2 md:py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 shadow-lg text-sm md:text-base min-h-[44px]`}
                                        >
                                            <Download className="w-4 h-4 md:w-5 md:h-5" />
                                            <span>Download</span>
                                        </button>
                                        <button
                                            onClick={() => {
                                                const text = shoppingList.map(item => {
                                                    if (item.count > 1) {
                                                        return `â˜ ${item.name}\n   ${item.originalAmount} ${item.unit} Ã— ${item.count} times = ${item.totalAmount} ${item.unit} total\n   For: ${item.meal}`;
                                                    } else {
                                                        return `â˜ ${item.name} - ${item.totalAmount} ${item.unit}\n   For: ${item.meal}`;
                                                    }
                                                }).join('\n\n');
                                                navigator.clipboard.writeText(text);
                                                alert('Shopping list copied!');
                                            }}
                                            className={`flex-1 ${theme.accent} ${theme.accentHover} text-white px-4 py-2 md:py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 shadow-lg text-sm md:text-base min-h-[44px]`}
                                        >
                                            <ShoppingCart className="w-4 h-4 md:w-5 md:h-5" />
                                            <span>Copy</span>
                                        </button>
                                    </div>

                                    <div className="pt-3">
                                        <button
                                            onClick={() => setShowShoppingList(false)}
                                            className={`w-full ${theme.accent} ${theme.accentHover} text-white px-4 py-3 rounded-xl font-medium transition-all shadow-lg min-h-[44px]`}
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MealPlanner />);
    </script>
</body>
</html>